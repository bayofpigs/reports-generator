define(["jspdf","table","lodash"],function(e,t,n){var r={x:612,y:792},i={x:595,y:842},s=50,o="portrait",u="letter",a=r,f=function(e){return e.toString().substring(0,15)},l=function(e){return e.toString().substring(0,24)},c=function(e,t,n){var r=50;e.setFont("Helvetica","Bold");var i=Math.ceil(a.x/7),s=Math.ceil(a.x*2/3),o=e.getStringUnitWidth(t,{font:"Helvetica",style:"Bold"}),u=s/o;u=u<r?u:r,e.setFontSize(u);var f=n+10+u;return e.text(i,n+u+10,t),f},h=function(e,t,n){var r=15;e.setFontSize(r),e.setFont("helvetica","normal"),n+=20;var i=a.y-s,o=Object.keys(t),u=s,f=a.x/2,c=a.x-s,h=15;for(var p=0;p<o.length;p++){var d=o[p].toString(),v=t[d].toString(),m=e.getStringUnitWidth(d,{font:"Helvetica"}),g=e.getStringUnitWidth(v,{font:"Helvetica"}),y=(f-u)/m,b=(c-f)/g,w=Math.min(y,b);h>w&&(h=w)}e.setFontSize(h);for(var p=0;p<o.length;p++){n>=i&&(n=s,e.addPage());var d=o[p].toString(),E=t[d],v=E.toString();E instanceof Date&&(v=l(v));var S=u,x=f;e.text(S,n+h+5,d),e.text(x,n+h+5,v),e.rect(S,n,f-u,h+10),e.rect(x,n,c-f,h+10),n+=h+10}return n},p=function(e,t,n){n+=10;var r=t.length,i=s,o=a.x-s,u=o-i,f=a.y-s,l=t.title,c=t.labels,h=t.rows,p=h.length,d=t.length,v=15,m=8,g=5,y=e.getStringUnitWidth(l,{font:"Helvetica",style:"Bold"}),b=u/y;v=b<v?b:v,e.setFont("Helvetica","Bold"),e.setFontSize(v);var w=v+g+(m+g)*(p+1);w+n>f&&w<f&&(n=s,e.addPage()),e.text(a.x/2-v*y/2,n+v,l),e.setLineWidth(1),e.line(i,n,o,n),e.setLineWidth(.5),n+=v+g,e.setLineWidth(1),e.line(i,n,o,n),e.setLineWidth(.5);var E=[];for(var S=0;S<d;S++){var x=u/d,T=i+x*S,N=i+x*(S+1),C=(T+N)/2;E[S]={partSize:x,partStart:T,partEnd:N,partMid:C},console.log(E[S])}e.setFontSize(m);var k=function(e,t,n){var r=t.toString();t instanceof Date&&(r=r.substring(0,15));var i=e.getStringUnitWidth(t)*m,s=r.length,o=[];if(i>=n){var u=Math.ceil(i/n),a=Math.ceil(s/u);for(var f=0;f<u;f++){var l=a*f,c=a*(f+1);c=c<=s?c:s,o[o.length]=r.substring(l,c)}return console.log(o),o}return r},L=function(e,t,r){var i=n;if(t instanceof Array)for(var s=0;s<t.length;s++){var o=t[s];s!=t.length-1&&(o+="-"),e.text(r,i+m,o),i+=m+g}else e.text(r,i+m,t),i+=m+g;return i},A=function(e,t){var r=n;for(var s=0;s<t.length;s++){var u=E[s],a=u.partStart,f=t[s],l=k(e,f,u.partSize),c=L(e,l,a);r<c&&(r=c)}e.line(i,r,o,r);for(var s=0;s<t.length;s++);return r};n=A(e,c),e.setFont("helvetica","normal");for(var S=0;S<p;S++)n=A(e,h[S]),n>f&&(n=s,e.addPage());return n},d=function(e,t,n){var r=t.length;for(var i=0;i<r;i++){var s=t[i];n=p(e,s,n)}return n},v=function(t,n){var r={},i=new e(o,"pt",u),s=0,a=Object.keys(t);for(var f=0;f<a.length;f++){var l=t[a[f]],p=l.name,v=l.information,m=l.data;s=c(i,p,s),v&&(s=h(i,v,s)),s=d(i,m,s),f!=a.length-1&&(s=0,i.addPage())}r.save=i.save.bind(i),n(null,r)};return v});